services:
    # ---------- Backend API (Node + Express) ----------
    - type: web
      name: draft-helper-api
      env: node
      plan: free
      rootDir: backend
      buildCommand: npm install
      startCommand: node server.js
      autoDeploy: true

      envVars:
          - key: NODE_ENV
            value: production
          - key: PORT
            value: 4000

          # ==== Secure environment variables set in Render dashboard ====
          - key: MONGODB_URI
            sync: false
          - key: AUTH0_DOMAIN
            sync: false
          - key: AUTH0_AUDIENCE
            sync: false

          # Once the frontend is deployed you can update this if needed
          - key: CORS_ORIGIN
            value: https://draft-helper-frontend.onrender.com

    # ---------- Frontend (Vite React static site) ----------
    - type: web
      name: draft-helper-frontend
      env: static
      rootDir: frontend
      buildCommand: npm install && npm run build
      staticPublishPath: dist

      envVars:
          # Use backend's external URL directly as Vite API base
          - key: VITE_API_BASE
            fromService:
                type: web
                name: draft-helper-api
                envVarKey: RENDER_EXTERNAL_URL
